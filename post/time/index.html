<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>cheatsheets</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content=""><meta data-n-head="ssr" name="format-detection" content="telephone=no"><meta data-n-head="ssr" data-hid="charset" charset="utf-8"><meta data-n-head="ssr" data-hid="mobile-web-app-capable" name="mobile-web-app-capable" content="yes"><meta data-n-head="ssr" data-hid="apple-mobile-web-app-title" name="apple-mobile-web-app-title" content="cheatsheets"><meta data-n-head="ssr" data-hid="og:type" name="og:type" property="og:type" content="website"><meta data-n-head="ssr" data-hid="og:title" name="og:title" property="og:title" content="cheatsheets"><meta data-n-head="ssr" data-hid="og:site_name" name="og:site_name" property="og:site_name" content="cheatsheets"><meta data-n-head="ssr" data-hid="og:description" name="og:description" property="og:description" content="记录常用的一些命令的 cheatsheets"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" data-hid="shortcut-icon" rel="shortcut icon" href="/_nuxt/icons/icon_64x64.e3e9fb.png"><link data-n-head="ssr" data-hid="apple-touch-icon" rel="apple-touch-icon" href="/_nuxt/icons/icon_512x512.e3e9fb.png" sizes="512x512"><link data-n-head="ssr" rel="manifest" href="/_nuxt/manifest.36955b7f.json" data-hid="manifest"><link rel="preload" href="/_nuxt/9d7406d.js" as="script"><link rel="preload" href="/_nuxt/4b3af57.js" as="script"><link rel="preload" href="/_nuxt/1d15557.js" as="script"><link rel="preload" href="/_nuxt/aa92a69.js" as="script"><link rel="preload" href="/_nuxt/6c06661.js" as="script"><style data-vue-ssr-id="517a8dd7:0 1a73ea6b:0 1d5e4f04:0">code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0%;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}body{margin-top:0;padding-top:0;margin:0;padding:0;background-color:#000;font-weight:100;color:#e4ebf0}.page-header{overflow:visible;height:50px;padding:0 36px;z-index:2;font-size:.85em;color:#7e888b;background:rgba(0,0,0,0);background-color:#192323}@media(max-width:767px){.page-header{padding:0 10px}}.page-header .btn{display:block;height:50px;padding:0 15px;border-bottom:0;color:#ccc;text-transform:uppercase;line-height:50px;-webkit-box-shadow:none!important;box-shadow:none!important;position:relative;font-size:14px}.page-header .btn img{height:50%;vertical-align:middle}.page-header .edit{color:#61dafb;text-decoration:none}.page-header a:hover{background:#000}.pull-left{float:left}.markdown-content>a:first-child~:nth-child(2){margin-top:0!important}.margin-tb-zero,.markdown-content ol ol,.markdown-content ol ul,.markdown-content ol ul ol,.markdown-content ol ul ul,.markdown-content ul ol,.markdown-content ul ul,.markdown-content ul ul ol,.markdown-content ul ul ul{margin-top:0;margin-bottom:0}.markdown-content{font-size:16px;line-height:1.6;word-wrap:break-word;padding:45px}.markdown-content>:first-child{margin-top:0!important}.markdown-content>:last-child{margin-bottom:0!important}.markdown-content *{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.markdown-content h1,.markdown-content h2,.markdown-content h3,.markdown-content h4,.markdown-content h5,.markdown-content h6{margin-top:1em;margin-bottom:16px;font-weight:700;line-height:1.4}.markdown-content blockquote,.markdown-content dl,.markdown-content ol,.markdown-content p,.markdown-content pre,.markdown-content table,.markdown-content ul{margin-top:0;margin-bottom:16px}.markdown-content h1{margin:.67em 0;padding-bottom:.3em;font-size:2.25em;line-height:1.2;border-bottom:1px solid #eee}.markdown-content h2{padding-bottom:.3em;font-size:1.75em;line-height:1.225;border-bottom:1px solid #eee}.markdown-content h3{font-size:1.5em;line-height:1.43}.markdown-content h4{font-size:1.25em}.markdown-content h5{font-size:1em}.markdown-content h6{font-size:1em;color:#777}.markdown-content ol,.markdown-content ul{padding-left:2em}.markdown-content ol ol,.markdown-content ul ol{list-style-type:lower-roman}.markdown-content ol ul,.markdown-content ul ul{list-style-type:circle}.markdown-content ol ul ul,.markdown-content ul ul ul{list-style-type:square}.markdown-content ol{list-style-type:decimal}.markdown-content ul{list-style-type:disc}.markdown-content blockquote{margin-left:0;margin-right:0;padding:0 15px;color:#777;border-left:4px solid #333}.markdown-content table{display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all;border-collapse:collapse;border-spacing:0}.markdown-content table tr{background-color:#fff;border-top:1px solid #ccc}.markdown-content table tr:nth-child(2n){background-color:#f8f8f8}.markdown-content table td,.markdown-content table th{padding:6px 13px;border:1px solid #ddd}.markdown-content pre{word-wrap:normal;padding:16px;overflow:auto;font-size:85%;line-height:1.45;color:#cae3b6;background-color:#1b1d1e;-webkit-border-radius:3px;border-radius:3px}.markdown-content pre code{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;font-size:100%;line-height:inherit;word-wrap:normal;white-space:pre;border:0;-webkit-border-radius:3px;border-radius:3px;background-color:rgba(0,0,0,0)}.markdown-content pre code:after,.markdown-content pre code:before{content:normal}.markdown-content code{font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;padding:0;padding-top:.2em;padding-bottom:.2em;margin:0;font-size:85%;background-color:rgba(0,0,0,.04);-webkit-border-radius:3px;border-radius:3px}.markdown-content code:after,.markdown-content code:before{letter-spacing:-.2em;content:" "}.markdown-content a{color:#4078c0;text-decoration:none;background:rgba(0,0,0,0)}.markdown-content img{max-width:100%;max-height:100%;-webkit-border-radius:4px;border-radius:4px;-webkit-box-shadow:0 0 10px #555;box-shadow:0 0 10px #555}.markdown-content strong{font-weight:700}.markdown-content em{font-style:italic}.markdown-content del{text-decoration:line-through}.task-list-item{list-style-type:none}.task-list-item input{font:13px/1.4 Helvetica,arial,nimbussansl,liberationsans,freesans,clean,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";margin:0 .35em .25em -1.6em;vertical-align:middle}.task-list-item input[disabled]{cursor:default}.task-list-item input[type=checkbox]{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:0}.task-list-item input[type=radio]{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:0}</style><link rel="preload" href="/_nuxt/static/1673864890/post/time/state.js" as="script"><link rel="preload" href="/_nuxt/static/1673864890/post/time/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1673864890/manifest.js" as="script">
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><div class="page-header"><a href="/" title="search" class="btn pull-left toggle-search"><img src="/search.svg"></a> <a href="https://github.com/MwumLi/cheatsheets/tree/master/markdowns/time.post.md" target="_blank" class="btn pull-left edit">在 Github 上编辑此页</a></div> <div class="page-wrapper"><div class="markdown-content"><h1 id="time---性能分析">time - 性能分析</h1>
<p><code>time</code>
 命令是开发过程中常用到的一个系统命令，主要是查看某个程序运行的时间分布  </p>
<h2 id="简单使用">简单使用</h2>
<p>命令原型: <code>time &lt;command></code>
  </p>
<p>例如:  </p>
<pre><code>$ <span class="hljs-type">time</span> ls -l
anaconda-ks.cfg  install.<span class="hljs-keyword">log</span>  install.<span class="hljs-keyword">log</span>.syslog  satools  <span class="hljs-type">text</span>

<span class="hljs-type">real</span>    <span class="hljs-number">0</span>m0<span class="hljs-number">.009</span>s
<span class="hljs-keyword">user</span>    <span class="hljs-number">0</span>m0<span class="hljs-number">.002</span>s
sys     <span class="hljs-number">0</span>m0<span class="hljs-number">.007</span>s
</code></pre>
<h3 id="运行结果">运行结果</h3>
<p>运行结果一般有三个值:  </p>
<ul>
<li><code>real</code>
: 墙上时间，即命令从开始执行到执行结束的总时间</li>
<li><code>user</code>
: 命令执行完成花费的用户 CPU 时间，即命令在用户态中执行时间总和  </li>
<li><code>sys</code>
: 命令执行完成花费的系统 CPU 时间，即命令在内核态(系统调用)中执行时间总和</li>
</ul>
<p>如果存在多核, 那么<code>user</code>
 和 <code>sys</code>
 的时间是多核时间累计  </p>
<p>因此, <strong>运行结果分析</strong>如下:  </p>
<ul>
<li><code>user + sys >= real</code>
: 存在密集型计算任务, 并且使用多核并发  </li>
<li><code>user + sys &lt;&lt; real</code>
: cpu 使用时间远远小于命令运行时间, IO 密集型应用</li>
</ul>
<h2 id="你运行的可能是假-time">你运行的可能是假 time</h2>
<p>shell 内建有一个 time 命令, 当你直接运行 <code>time</code>
 的时候, 很大可能性运行的是系统内建命令  </p>
<p>运行系统内建 time 没有什么问题, 只是系统内建命令的功能有限, 只能像上文那样简单使用  </p>
<p>使用 <code>type time</code>
 可以确认是否 shell 内置 <code>time</code>
:  </p>
<pre><code>$ <span class="hljs-built_in">type</span> <span class="hljs-built_in">time</span>
<span class="hljs-built_in">time</span> is a <span class="hljs-built_in">shell</span> <span class="hljs-function"><span class="hljs-keyword">keyword</span></span>
</code></pre>
<p><code>/usr/bin/time</code>
 是真正的 <code>time</code>
 命令, 通过 <code>which time</code>
 验证:  </p>
<pre><code>$ which <span class="hljs-built_in">time</span>
/usr/bin/<span class="hljs-built_in">time</span>
</code></pre>
<p>对于真正的 <code>time</code>
 命令, 你只能通过指定全路径使用  </p>
<h3 id="使用">使用</h3>
<p>简单打印, 没换行, 不直观: <code>/usr/bin/time ls</code>
  </p>
<pre><code>$ /usr/bin/time <span class="hljs-keyword">ls</span>
Makefile  aa.c  outfile.txt
<span class="hljs-number">0.00</span>user <span class="hljs-number">0.00</span><span class="hljs-keyword">system</span> <span class="hljs-number">0</span>:<span class="hljs-number">00.00</span>elapsed <span class="hljs-number">0</span>%CPU (<span class="hljs-number">0</span>avgtext+<span class="hljs-number">0</span>avgdata <span class="hljs-number">2432</span>maxresident)k
<span class="hljs-number">0</span>inputs+<span class="hljs-number">0</span>outputs (<span class="hljs-number">0</span>major+<span class="hljs-number">105</span>minor)pagefaults <span class="hljs-number">0</span>swaps
</code></pre>
<p>和内建 <code>time</code>
 一样的打印:  </p>
<pre><code>$ /usr/bin/<span class="hljs-selector-tag">time</span> -<span class="hljs-selector-tag">p</span> ls
Makefile  aa<span class="hljs-selector-class">.c</span>  outfile<span class="hljs-selector-class">.txt</span>
real <span class="hljs-number">0.00</span>
user <span class="hljs-number">0.00</span>
sys <span class="hljs-number">0.00</span>
</code></pre>
<p>使用 <code>-f</code>
 自定义信息输出, 比如下面模拟了 <code>-p</code>
 的选项:  </p>
<pre><code>$ /usr/bin/<span class="hljs-keyword">time</span> -f <span class="hljs-string">"real %e\nuser %U\nsys %S\n"</span> <span class="hljs-keyword">sleep</span> <span class="hljs-number">1</span>
real <span class="hljs-number">1.00</span>
user <span class="hljs-number">0</span>.<span class="hljs-number">00</span>
sys <span class="hljs-number">0</span>.<span class="hljs-number">00</span>
</code></pre>
<p><code>-f</code>
 支持的更多选项参考: <a href="http://man.linuxde.net/time" target="_blank">http://man.linuxde.net/time</a>  </p>
<p>使用 <code>-v</code>
 打印详细信息:  </p>
<pre><code><span class="hljs-attribute">$ /usr/bin/time -v ls
Makefile  aa.c  outfile.txt
                Command being timed</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ls"</span>
                <span class="hljs-attribute">User time (seconds)</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0.00</span>
                <span class="hljs-attribute">System time (seconds)</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0.00</span>
                <span class="hljs-attribute">Percent of CPU this job got</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0%</span>
                Elapsed (wall clock) time (h:mm:ss or m:ss): 0:00.00
                <span class="hljs-attribute">Average shared text size (kbytes)</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0</span>
                <span class="hljs-attribute">Average unshared data size (kbytes)</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0</span>
                <span class="hljs-attribute">Average stack size (kbytes)</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0</span>
                <span class="hljs-attribute">Average total size (kbytes)</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0</span>
                <span class="hljs-attribute">Maximum resident set size (kbytes)</span><span class="hljs-punctuation">:</span> <span class="hljs-string">2340</span>
                <span class="hljs-attribute">Average resident set size (kbytes)</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0</span>
                <span class="hljs-attribute">Major (requiring I/O) page faults</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0</span>
                <span class="hljs-attribute">Minor (reclaiming a frame) page faults</span><span class="hljs-punctuation">:</span> <span class="hljs-string">105</span>
                <span class="hljs-attribute">Voluntary context switches</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0</span>
                <span class="hljs-attribute">Involuntary context switches</span><span class="hljs-punctuation">:</span> <span class="hljs-string">6</span>
                <span class="hljs-attribute">Swaps</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0</span>
                <span class="hljs-attribute">File system inputs</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0</span>
                <span class="hljs-attribute">File system outputs</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0</span>
                <span class="hljs-attribute">Socket messages sent</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0</span>
                <span class="hljs-attribute">Socket messages received</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0</span>
                <span class="hljs-attribute">Signals delivered</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0</span>
                <span class="hljs-attribute">Page size (bytes)</span><span class="hljs-punctuation">:</span> <span class="hljs-string">4096</span>
                <span class="hljs-attribute">Exit status</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0</span>
</code></pre>
</div></div></div></div></div><script defer src="/_nuxt/static/1673864890/post/time/state.js"></script><script src="/_nuxt/9d7406d.js" defer></script><script src="/_nuxt/6c06661.js" defer></script><script src="/_nuxt/4b3af57.js" defer></script><script src="/_nuxt/1d15557.js" defer></script><script src="/_nuxt/aa92a69.js" defer></script>
  </body>
</html>
